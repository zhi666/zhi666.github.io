<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><meta name="keywords" content="[object Object]"><meta name="description" content="一，docker介绍使用"><meta name="author" content="zhi666"><title>docker的使用 - 逸尘秀</title><meta description="一，docker介绍使用"><meta property="og:type" content="article"><meta property="og:title" content="docker的使用"><meta property="og:url" content="https://yc6.cool/2020/08/04/docker%E4%BD%BF%E7%94%A8/"><meta property="og:site_name" content="逸尘秀"><meta property="og:description" content="一，docker介绍使用"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2020-08-04T03:00:36.000Z"><meta property="article:modified_time" content="2023-11-01T02:25:44.554Z"><meta property="article:author" content="zhi666"><meta property="article:tag" content="docker"><meta property="article:tag" content="容器"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://yc6.cool/img/avatar.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://yc6.cool/2020/08/04/docker%E4%BD%BF%E7%94%A8/"},"headline":"docker的使用","image":["https://yc6.cool/img/avatar.png"],"datePublished":"2020-08-04T03:00:36.000Z","dateModified":"2023-11-01T02:25:44.554Z","author":{"@type":"Person","name":"zhi666"},"description":"一，docker介绍使用"}</script><link rel="alternative" href="/atom.xml" title="逸尘秀" type="application/atom+xml"><link rel="icon" href="/img/favicon.png"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Ubuntu:400,600|Source+Code+Pro|Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Microsoft YaHei:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;amp;subset=latin,latin-ext|Inconsolata|Itim|Lobster.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.12/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/pace/1.0.2/pace.min.js"></script><link rel="stylesheet" href="/css/style.css"><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="/js/globalUtils.js"></script><link rel="stylesheet" href="/live2d/waifu.css"><script type="text/javascript" async src="/live2d/autoload.js"></script></head><body class="is-3-column has-navbar-fixed-top"><nav class="navbar navbar-main is-fixed-top"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="逸尘秀" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/media">影音</a><a class="navbar-item" href="/album">相册</a><a class="navbar-item" href="/friend">友链</a><a class="navbar-item" href="/self-talking">碎碎念</a><a class="navbar-item" href="/message">留言</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/zhi666"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a></div></div></div></nav><script type="text/javascript" src="/js/theme-setting.js"></script><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2020-08-04  <a class="commentCountImg" href="/2020/08/04/docker%E4%BD%BF%E7%94%A8/#comment-container"><span class="display-none-class">ffc51dddef33db9d81cc3e4c06110c69</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="ffc51dddef33db9d81cc3e4c06110c69">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>1 小时  <i class="fas fa-pencil-alt"> </i>8.2 k</span><span class="level-item" id="busuanzi_container_page_pv"><i class="far fa-eye"></i>&nbsp;&nbsp;<span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">docker的使用</h1><div class="content"><h1 id="一，docker介绍使用"><a href="#一，docker介绍使用" class="headerlink" title="一，docker介绍使用"></a>一，docker介绍使用</h1><a id="more"></a>
<h2 id="1-Docker-安装"><a href="#1-Docker-安装" class="headerlink" title="1.Docker 安装"></a><strong>1.Docker 安装</strong></h2><p><strong>windos安装</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">直接官网下载就可以了</span><br><span class="line">https:&#x2F;&#x2F;download.docker.com&#x2F;win&#x2F;stable&#x2F;Docker%20Desktop%20Installer.exe</span><br></pre></td></tr></table></figure>



<p>Docker支持以下的CentOS版本：<br>    CentOS 7 (64-bit)<br>    CentOS 6.5 (64-bit) 或更高的版本<br>前提条件<br>目前，CentOS 仅发行版本中的内核支持 Docker。<br>Docker 运行在 CentOS 7 上，要求系统为64位、系统内核版本为 3.10 以上。<br>Docker 运行在 CentOS-6.5 或更高的版本的 CentOS 上，要求系统为64位、系统内核版本为 2.6.32-431 或者更高版本。</p>
<h3 id="1-使用-yum-安装（CentOS-7下）"><a href="#1-使用-yum-安装（CentOS-7下）" class="headerlink" title="1.使用 yum 安装（CentOS 7下）"></a><strong>1.使用 yum 安装（CentOS 7下）</strong></h3><p>Docker 要求 CentOS 系统的内核版本高于 3.10 ，查看本页面的前提条件来验证你的CentOS 版本是否支持 Docker 。<br>通过 uname -r 命令查看你当前的内核版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# uname -r</span><br></pre></td></tr></table></figure>
<p>从 2017 年 3 月开始 docker 在原来的基础上分为两个分支版本: Docker CE 和 Docker EE。<br>Docker CE 即社区免费版，Docker EE 即企业版，强调安全，但需付费使用。<br>本文介绍 Docker CE 的安装使用。</p>
<p><strong>docker的官方文档安装</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;docs.docker.com&#x2F;engine&#x2F;install&#x2F;centos&#x2F;</span><br></pre></td></tr></table></figure>



<p>移除旧的版本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sudo yum remove docker \</span><br><span class="line">                docker-client \</span><br><span class="line">                docker-client-latest \</span><br><span class="line">                docker-common \</span><br><span class="line">                docker-latest \</span><br><span class="line">                docker-latest-logrotate \</span><br><span class="line">                docker-logrotate \</span><br><span class="line">                docker-selinux \</span><br><span class="line">                docker-engine-selinux \</span><br><span class="line">                docker-engine</span><br></pre></td></tr></table></figure>

<p><strong>安装一些必要的系统依赖工具</strong>：    </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></table></figure>

<p><strong>添加软件源信息</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">阿里云的软件源:</span><br><span class="line">yum-config-manager --add-repo http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo</span><br><span class="line"></span><br><span class="line">wget https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo</span><br><span class="line"></span><br><span class="line">官方的下载源:</span><br><span class="line">sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo</span><br></pre></td></tr></table></figure>



<p><strong>更新 yum 缓存</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum makecache fast</span><br></pre></td></tr></table></figure>

<p><strong>列出Docker软件版本信息</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum list docker-ce --showduplicates | sort -r</span><br></pre></td></tr></table></figure>



<p><strong>安装 Docker-ce</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">yum -y install docker-ce     &#x2F;&#x2F;默认安装最新版本</span><br><span class="line">yum -y install docker-ce-3:18.09.7-3.el7   &#x2F;&#x2F;安装指定版本</span><br></pre></td></tr></table></figure>

<p><strong>支持端口转发</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;net.ipv4.ip_forward &#x3D; 1&quot; &gt;&gt; &#x2F;etc&#x2F;sysctl.conf </span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>



<p><strong>重新加载systemctl配置</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">如果修改了systemctl edit docker.service 这个文件，就要执行这步操作</span><br><span class="line"></span><br><span class="line">	systemctl daemon-reload</span><br></pre></td></tr></table></figure>



<p><strong>启动 Docker 后台服务</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker</span><br><span class="line">systemctl status docker</span><br><span class="line">systemctl enable docker</span><br></pre></td></tr></table></figure>

<h4 id="1-1docker疑难杂症：docker命令Tab无法自动补全"><a href="#1-1docker疑难杂症：docker命令Tab无法自动补全" class="headerlink" title="1.1docker疑难杂症：docker命令Tab无法自动补全"></a><strong>1.1docker疑难杂症：docker命令Tab无法自动补全</strong></h4><p><strong>1.安装bash-complete</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y bash-completion</span><br></pre></td></tr></table></figure>

<p><strong>2.刷新文件</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">source &#x2F;usr&#x2F;share&#x2F;bash-completion&#x2F;completions&#x2F;docker</span><br><span class="line">source &#x2F;usr&#x2F;share&#x2F;bash-completion&#x2F;bash_completion</span><br></pre></td></tr></table></figure>

<p><strong>查看版本信息</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker version</span><br><span class="line">docker info</span><br></pre></td></tr></table></figure>

<p><strong>测试Docker安装</strong></p>
<p>通过运行<a href="https://hub.docker.com/_/hello-world/">hello-world</a> Docker映像来测试安装是否正常：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run hello-world</span><br></pre></td></tr></table></figure>

<h3 id="2-使用脚本安装-Docker"><a href="#2-使用脚本安装-Docker" class="headerlink" title="2.使用脚本安装 Docker"></a><strong>2.使用脚本安装 Docker</strong></h3><p>1、使用 sudo 或 root 权限登录 Centos。</p>
<p>2、确保 yum 包更新到最新</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum update</span><br></pre></td></tr></table></figure>

<p>3、执行 Docker 安装脚本。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https:&#x2F;&#x2F;get.docker.com -o get-docker.sh</span><br><span class="line"></span><br><span class="line">sudo sh get-docker.sh</span><br></pre></td></tr></table></figure>

<p>执行这个脚本会添加 docker.repo 源并安装 Docker</p>
<p>4、启动 Docker 进程。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker</span><br><span class="line">systemctl status docker</span><br><span class="line">systemctl enable docker</span><br></pre></td></tr></table></figure>

<p>5、查看版本信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker version</span><br><span class="line">docker info</span><br></pre></td></tr></table></figure>

<h3 id="3-删除卸载Docker-CE"><a href="#3-删除卸载Docker-CE" class="headerlink" title="3,删除卸载Docker CE"></a><strong>3,删除卸载Docker CE</strong></h3><p>执行以下命令来删除 Docker CE：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo yum remove docker-ce docker-ce-cli containerd.io -y</span><br><span class="line">sudo rm -rf &#x2F;var&#x2F;lib&#x2F;docker</span><br></pre></td></tr></table></figure>

<h2 id="2-Docker的使用"><a href="#2-Docker的使用" class="headerlink" title="2.Docker的使用"></a><strong>2.Docker的使用</strong></h2><h3 id="1-docker常用命令"><a href="#1-docker常用命令" class="headerlink" title="1.docker常用命令"></a><strong>1.docker常用命令</strong></h3><h4 id="1-镜像仓库"><a href="#1-镜像仓库" class="headerlink" title="1.镜像仓库"></a><strong>1.镜像仓库</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.搜索镜像</span><br><span class="line">docker search centos </span><br><span class="line"></span><br><span class="line">2. 从镜像参数中拉取指定镜像</span><br><span class="line">docker pull  centos  </span><br><span class="line"></span><br><span class="line">docker官方镜像库</span><br><span class="line">https:&#x2F;&#x2F;hub.docker.com&#x2F;</span><br></pre></td></tr></table></figure>





<h4 id="2-镜像相关命令"><a href="#2-镜像相关命令" class="headerlink" title="2.镜像相关命令"></a><strong>2.镜像相关命令</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">1.列出本地镜像</span><br><span class="line">docker images</span><br><span class="line">docker images -a</span><br><span class="line">docker image ls</span><br><span class="line"></span><br><span class="line">2.删除镜像</span><br><span class="line">docker rmi 镜像名</span><br><span class="line">docker rmi -f 镜像名  &#x2F;&#x2F;强制删除镜像</span><br><span class="line"></span><br><span class="line">3.查到指定镜像的创建历史</span><br><span class="line">docker history 镜像名</span><br><span class="line"></span><br><span class="line">4.将指定镜像保存为tar归档文件 -o 输出指定文件</span><br><span class="line">docker save -o hello.tar hello-world    &#x2F;&#x2F;hello-world为镜像名。 hello.tar为指定输出的文件</span><br><span class="line"></span><br><span class="line">5.由tar文档生成镜像</span><br><span class="line">docker import -m &quot;有本地保存的tar文件生成&quot; .&#x2F;hello.tar  hello-world</span><br><span class="line">参数说明: -m 为创建的镜像设置描述信息，可以通过docker history -H 查看。</span><br><span class="line">		.&#x2F;hello.tar 为tar文件的路径，  hello-world 为镜像名字</span><br><span class="line"></span><br><span class="line">6.使用dockerfile创建镜像</span><br><span class="line"> docker build [可选选项] 文件路径 . 当前目录</span><br><span class="line"> docker build -t look&#x2F;centos7.3  .</span><br><span class="line"> 参数说明：</span><br><span class="line"> -t ：指定要创建的目标镜像名</span><br><span class="line"> .  ：Dockerfile 文件所在目录，可以指定Dockerfile 的绝对路径</span><br><span class="line"> </span><br><span class="line"> 7. 创建某个镜像的副本</span><br><span class="line"> docker tag src_image[:tag] tar_image[:tag]</span><br><span class="line"> docker tag centos:latest  localhost:5000&#x2F;centos   #把本地的centos镜像复制一份，命名为localhost:5000&#x2F;centos</span><br></pre></td></tr></table></figure>

<h4 id="3-容器操作常见命令"><a href="#3-容器操作常见命令" class="headerlink" title="3.容器操作常见命令"></a><strong>3.容器操作常见命令</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">1.docker ps      列出容器 </span><br><span class="line">	docker ps -a  -a 只显示正在运行的</span><br><span class="line"></span><br><span class="line">2.docker inspect 7019f9fdf8ab  查看容器或镜像的元数据</span><br><span class="line"></span><br><span class="line">3.docker top   容器名   查看指定容器中运行的进程</span><br><span class="line"></span><br><span class="line">4.docker exec -it  容器名 &#x2F;bin&#x2F;bash   &#x2F;&#x2F;进入容器</span><br><span class="line"></span><br><span class="line">5.docker logs -f  容器名     #查看容器的实时日志</span><br><span class="line"></span><br><span class="line">6.docker cp   &#x2F;&#x2F; 容器与主机之间的文件复制</span><br><span class="line">  从容器中复制到主机</span><br><span class="line">	docker cp testtomcat:&#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;webapps&#x2F;test&#x2F;js&#x2F;test.js &#x2F;opt</span><br><span class="line">	</span><br><span class="line">  从主机复制到容器中</span><br><span class="line">	docker cp &#x2F;opt&#x2F;test.js testtomcat:&#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;webapps&#x2F;test&#x2F;js	</span><br><span class="line"></span><br><span class="line">	选项: </span><br><span class="line">	-a  复制所有的gid&#x2F;uid信息</span><br><span class="line">	-L   Always follow symbol link in SRC_PATH 始终遵循原路径的符号信息</span><br><span class="line"></span><br><span class="line">7.docker difff CONTAINER &#x2F;&#x2F; 查看容器中被修改过的文件或目录</span><br><span class="line"></span><br><span class="line">8.启动停止重启容器</span><br><span class="line">docker stop hello-world</span><br><span class="line">docker start hello-world</span><br><span class="line">docker restart hello-world</span><br><span class="line">docker kill hello-world  #杀死一个容器</span><br><span class="line"></span><br><span class="line">9.查看所有容器id </span><br><span class="line">	docker ps -aq</span><br><span class="line"></span><br><span class="line">10.删除所有容器</span><br><span class="line">	docker rm $(docker ps -aq)</span><br><span class="line"></span><br><span class="line">11.查看所有没有运行的容器id</span><br><span class="line">	docker ps -f &quot;status&#x3D;exited&quot; -q</span><br><span class="line">	</span><br><span class="line">12. 删除所有没有运行的容器</span><br><span class="line">	 docker rm $(docker ps -f &quot;status&#x3D;exited&quot; -q)</span><br></pre></td></tr></table></figure>





<h4 id="4-运行容器"><a href="#4-运行容器" class="headerlink" title="4.运行容器"></a><strong>4.运行容器</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">运行容器</span><br><span class="line"></span><br><span class="line">docker run --name 容器名 -d -p 3306:3306 mysql  docker 启动容器</span><br><span class="line">docker run image_name</span><br><span class="line">docker run -d -p 80:80 nginx:latest</span><br><span class="line">run（创建并运行一个容器） </span><br><span class="line">-d 放在后台 </span><br><span class="line">-p 端口映射 :docker的容器端口</span><br><span class="line">-P 随机分配端口</span><br><span class="line">-v 源地址(宿主机):目标地址(容器)</span><br><span class="line"></span><br><span class="line">docker run -it --name centos6 centos:6.9 &#x2F;bin&#x2F;bash </span><br><span class="line">-it 分配交互式的终端 </span><br><span class="line">--name 指定容器的名字 </span><br><span class="line">&#x2F;bin&#x2F;sh覆盖容器的初始命令</span><br></pre></td></tr></table></figure>

<h3 id="2-构建Dockerfile"><a href="#2-构建Dockerfile" class="headerlink" title="2,构建Dockerfile"></a><strong>2,构建Dockerfile</strong></h3><p>编写一个go程序hello.go</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import &quot;fmt&quot;</span><br><span class="line"></span><br><span class="line">func main()&#123;</span><br><span class="line">fmt.Println(&quot;hello world&quot;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>创建一个文件Dockerfile命名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#从头开始</span><br><span class="line">FROM scratch</span><br><span class="line"></span><br><span class="line">#加到根目录</span><br><span class="line">ADD hello &#x2F;</span><br><span class="line"></span><br><span class="line">#运行hello</span><br><span class="line"></span><br><span class="line">CMD [&quot;&#x2F;hello&quot;]</span><br></pre></td></tr></table></figure>

<p>开始构建</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build  -t gohallo&#x2F;hello .</span><br></pre></td></tr></table></figure>

<p>把go程序跑起来</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run gohello&#x2F;hello</span><br></pre></td></tr></table></figure>

<p>下载一个centos镜像并跑起来</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker run centos </span><br><span class="line"></span><br><span class="line">docker run -it --name centosl -d centos </span><br><span class="line"></span><br><span class="line">拷贝hello文件到容器</span><br><span class="line">docker cp hello centosl:&#x2F;usr&#x2F;local&#x2F;</span><br><span class="line">进入容器</span><br><span class="line">docker exec -it centosl &#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure>

<h4 id="2-1Dockerfile-详解"><a href="#2-1Dockerfile-详解" class="headerlink" title="2.1Dockerfile 详解"></a><strong>2.1Dockerfile 详解</strong></h4><p><strong>1.FROM</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">文件的开始</span><br><span class="line">FROM   scratch       #从头开始制作一个最简单的</span><br><span class="line">FROM   centos        #使用centos 为系统，本地若没有则拉取</span><br><span class="line">FROM   centos:7.0    #指定系统+ 版本号</span><br></pre></td></tr></table></figure>

<p><strong>2.LABEL</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LABEL：相当于注释，或者说明信息。</span><br><span class="line">LABEL  version&#x3D;&quot;1.0&quot;</span><br><span class="line">LABEL  author&#x3D;&quot;luke&quot;</span><br></pre></td></tr></table></figure>

<p><strong>3.RUN</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">RUN :相当于执行命令，每执行一条RUN,就会多一层</span><br><span class="line">RUN  yum -y update &amp;&amp; yum install -y lrzsz \</span><br><span class="line"> net-tools</span><br><span class="line"> </span><br><span class="line">\相当于连接线，如果一行写不完就可以这样做。</span><br></pre></td></tr></table></figure>

<p><strong>4.WORKDIR</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">WORKDIR   进入或创建目录</span><br><span class="line">WORKDIR  &#x2F;root   进入&#x2F;root目录</span><br><span class="line">WORKDIR  &#x2F;test   自动创建目录</span><br><span class="line">WORKDIR  demo</span><br><span class="line">RUN  pwd        # &#x2F;test&#x2F;demo  会打印这个路径</span><br></pre></td></tr></table></figure>

<p><strong>5.ADD and COPY</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ADD and COPY  将本地文件添加到镜像里</span><br><span class="line">ADD           可以解压文件</span><br><span class="line">ADD hello  &#x2F;          将主机当前的hello文件 添加到 容器的&#x2F;根目录下</span><br><span class="line">ADD XXX.tar.gz  &#x2F;     添加到根目录，并解压文件</span><br><span class="line"></span><br><span class="line">COPY hello &#x2F;  		  直接复制一份到&#x2F;目录下</span><br></pre></td></tr></table></figure>

<p><strong>6.ENV</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">功能为设置环境变量 </span><br><span class="line">ENV MYSQL_VERSION 5.6  #设置常量</span><br><span class="line">RUN yum install -y mysql-server&#x3D;&quot;$(MYSQL_VERSION)&quot;  等于下载mysql 5.6版本的</span><br><span class="line">或者</span><br><span class="line">设置了后，后续的 RUN 命令都可以使用，container 启动后，可以通过 docker inspect 查看这</span><br><span class="line">个环境变量，也可以通过在 docker run --env key&#x3D;value 时设置或修改环境变量。 </span><br><span class="line">假如你安装了 JAVA 程序，需要设置 JAVA_HOME，那么可以在 Dockerfile 中这样写： </span><br><span class="line">ENV JAVA_HOME &#x2F;usr&#x2F;local&#x2F;jdkxxxx&#x2F;</span><br></pre></td></tr></table></figure>

<p><strong>7.EXPOSE</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">EXPOSE 用于指定容器在运行时监听的端口： </span><br><span class="line">EXPOSE &lt;port&gt; [&lt;port&gt;...] </span><br><span class="line"> </span><br><span class="line">EXPOSE 并不会让容器的端口访问到主机。要使其可访问，需要在 docker run 运行容器时通过-p</span><br><span class="line">来发布这些端口，或通过-P 参数来发布 EXPOSE 导出的所有端口。</span><br><span class="line"> 映射一个端口   </span><br><span class="line">EXPOSE port1   </span><br><span class="line"># 相应的运行容器使用的命令   </span><br><span class="line">docker run -p port1 image   </span><br><span class="line">       </span><br><span class="line"># 映射多个端口   </span><br><span class="line">EXPOSE port1 port2 port3   </span><br><span class="line"># 相应的运行容器使用的命令   </span><br><span class="line">docker run -p port1 -p port2 -p port3 image   </span><br><span class="line"># 还可以指定需要映射到宿主机器上的某个端口号   </span><br><span class="line">docker run -p host_port1:port1 -p host_port2:port2 -p host_port3:port3 image   </span><br><span class="line"> </span><br><span class="line">端口映射是 docker 比较重要的一个功能，原因在于我们每次运行容器的时候容器的 IP 地址不能</span><br><span class="line">指定而是在桥接网卡的地址范围内随机生成的。 </span><br><span class="line">宿主机器的 IP 地址是固定的，我们可以将容器的端口的映射到宿主机器上的一个端口，免去每次</span><br><span class="line">访问容器中的某个服务时都要查看容器的 IP 的地址。 </span><br><span class="line">对于一个运行的容器，可以使用 docker port 加上容器中需要映射的端口和容器的 ID 来查看该</span><br><span class="line">端口号在宿主机器上的映射端口</span><br></pre></td></tr></table></figure>





<p><strong>8.CMD and ENTRYPOINT</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> #shell格式</span><br><span class="line">RUN yum install -y lrzsz </span><br><span class="line">CMD echo &quot;hello docker &quot;</span><br><span class="line">ENTRYPONINT echo &quot;hello docker&quot;</span><br><span class="line"></span><br><span class="line">#exec 格式</span><br><span class="line">RUN [&quot;yum&quot;,&quot;-y&quot;,&quot;install&quot;,&quot;lrzsz&quot;]</span><br><span class="line">CMD [&quot;&#x2F;bin&#x2F;echo&quot;,&quot;hello Docker&quot;]</span><br><span class="line">ENTRYPONINT [&quot;&#x2F;bin&#x2F;bash&quot;,&quot;-c&quot;,&quot;echo hello Docker&quot;]</span><br><span class="line"></span><br><span class="line">CMD 和ENTRYPOINT的区别</span><br><span class="line"></span><br><span class="line">CMD </span><br><span class="line">	若docker指定了其他命令，CMD 会被忽略 	</span><br><span class="line">	若定义了多个CMD，只会执行最后一个</span><br></pre></td></tr></table></figure>

<p><strong>9.VOLUME</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VOLUME [&quot;&#x2F;var&#x2F;www&#x2F;html&quot;,&quot;&#x2F;data&#x2F;mysql&#x2F;data&quot;]</span><br></pre></td></tr></table></figure>



<h3 id="3-搭建私有镜像仓库"><a href="#3-搭建私有镜像仓库" class="headerlink" title="3,搭建私有镜像仓库"></a><strong>3,搭建私有镜像仓库</strong></h3><p><strong>1.直接执行一条命令搭建</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">官网地址: https:&#x2F;&#x2F;hub.docker.com&#x2F;_&#x2F;registry</span><br><span class="line">docker run -d -p 5000:5000 --restart always --name registry registry:2</span><br><span class="line">或者</span><br><span class="line">docker run -d -p 5000:5000 --restart always --name registry -v &#x2F;opt&#x2F;reqistry:&#x2F;var&#x2F;lib&#x2F;registry registry:2</span><br><span class="line"></span><br><span class="line">&#x2F;var&#x2F;lib&#x2F;registry是容器存放镜像的目录</span><br></pre></td></tr></table></figure>

<p><strong>2.构建自己的镜像</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker build -t 192.168.224.11:5000&#x2F;centos2 .</span><br><span class="line"></span><br><span class="line">或者复制一份本地的镜像</span><br><span class="line">docker tag centos:latest  localhost:5000&#x2F;centos</span><br></pre></td></tr></table></figure>

<p><strong>3.上传到自己搭建的镜像仓库</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> docker push  192.168.224.11:5000&#x2F;centos2 </span><br><span class="line"> </span><br><span class="line">The push refers to repository [192.168.224.11:5000&#x2F;centos2]</span><br><span class="line">Get https:&#x2F;&#x2F;192.168.224.11:5000&#x2F;v2&#x2F;: http: server gave HTTP response to HTTPS client</span><br><span class="line">如果报错:</span><br><span class="line">echo &#39;&#123; &quot;insecure-registries&quot;:[&quot;192.168.224.11:5000&quot;] &#125;&#39; &gt; &#x2F;etc&#x2F;docker&#x2F;daemon.json</span><br><span class="line">重启docker</span><br><span class="line"></span><br><span class="line">docker push localhost:5000&#x2F;centos</span><br><span class="line"></span><br><span class="line">去仓库看看。</span><br><span class="line">http:&#x2F;&#x2F;192.168.224.11:5000&#x2F;v2&#x2F;_catalog</span><br></pre></td></tr></table></figure>

<p><strong>4.在本地删除构建的镜像</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker rmi 192.168.224.11:5000&#x2F;centos2:latest</span><br><span class="line"></span><br><span class="line">docker rmi localhost:5000&#x2F;centos:latest</span><br></pre></td></tr></table></figure>

<p><strong>5.然后在去搭建的私有创库去下载镜像</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker pull 192.168.224.11:5000&#x2F;centos2</span><br><span class="line">docker pull localhost:5000&#x2F;centos</span><br><span class="line"></span><br><span class="line">也是很快就下载下来了</span><br></pre></td></tr></table></figure>

<p><strong>6.本地仓库加安全认证</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1.生成密码:</span><br><span class="line">yum install -y httpd-tools </span><br><span class="line">mkdir &#x2F;opt&#x2F;registry-auth&#x2F; -p</span><br><span class="line">htpasswd -Bbn luke 123 &gt; &#x2F;opt&#x2F;registry-auth&#x2F;htpasswd</span><br><span class="line">多用户就追加</span><br><span class="line">htpasswd -Bbn luke1 123 &gt;&gt; &#x2F;opt&#x2F;registry-auth&#x2F;htpasswd</span><br><span class="line">2.重新启动带有秘钥功能的registry容器</span><br><span class="line">docker run -d -p 5000:5000 --restart always --name registry -v &#x2F;opt&#x2F;registry-auth&#x2F;:&#x2F;auth&#x2F; -v &#x2F;opt&#x2F;reqistry:&#x2F;var&#x2F;lib&#x2F;registry -e &quot;REGISTRY_AUTH&#x3D;htpasswd&quot; -e &quot;REGISTRY_AUTH_HTPASSWD_REALM&#x3D;Registry Realm&quot; -e &quot;REGISTRY_AUTH_HTPASSWD_PATH&#x3D;&#x2F;auth&#x2F;htpasswd&quot;  registry:2</span><br><span class="line"></span><br><span class="line">3.push镜像，需要进行login</span><br><span class="line">docker login 192.168.224.11:5000</span><br><span class="line"></span><br><span class="line">docker push 192.168.224.11:5000&#x2F;centos2</span><br><span class="line">上传成功</span><br><span class="line"></span><br><span class="line">docker logout 192.168.224.11:5000</span><br><span class="line">退出登录</span><br></pre></td></tr></table></figure>

<p><strong>7.docker-habor实现图形化镜像仓库</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">1.安装docker-compose</span><br><span class="line">yum install -y docker-compose</span><br><span class="line"></span><br><span class="line">2.下载harbor离线安装包并解压</span><br><span class="line">wget https:&#x2F;&#x2F;storage.googleapis.com&#x2F;harbor-releases&#x2F;release-1.7.0&#x2F;harbor-offline-installer-v1.7.1.tgz</span><br><span class="line"></span><br><span class="line">#解压harbor安装包:</span><br><span class="line"></span><br><span class="line">tar xvf harbor-offline-installer-v1.7.1.tgz</span><br><span class="line"></span><br><span class="line">3.修改harbor.cfg配置文件</span><br><span class="line">3.1 修改如下参数</span><br><span class="line">vim harbor&#x2F;harbor.cfg</span><br><span class="line"></span><br><span class="line">hostname &#x3D; 192.168.224.11</span><br><span class="line"></span><br><span class="line">barbor_admin_password &#x3D; luke123</span><br><span class="line"></span><br><span class="line">执行install.sh</span><br><span class="line"></span><br><span class="line">3.2.修改docker配置文件</span><br><span class="line">vim &#x2F;etc&#x2F;docker&#x2F;daemon.json</span><br><span class="line">#增加如下参数</span><br><span class="line"></span><br><span class="line">[&quot;192.168.224.11&quot;]</span><br><span class="line"></span><br><span class="line">&quot;live-restore&quot;:true</span><br><span class="line">3.3重启docker</span><br><span class="line">systemctl restart docker</span><br><span class="line"></span><br><span class="line">4.测试harbor仓库</span><br><span class="line">4.1 建立harbor项目</span><br><span class="line">通过web访问harbor仓库</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;192.168.224.11&#x2F;</span><br><span class="line"></span><br><span class="line">输入用户名和密码：</span><br><span class="line"></span><br><span class="line">默认用户admin</span><br><span class="line"></span><br><span class="line">密码：luke123  #修改harbor.cfg时设置的密码</span><br><span class="line">4.2建立项目，命名luke 设置公有</span><br><span class="line">4.3 给镜像打标签</span><br><span class="line">docker tag centos:latest 192.168.224.11&#x2F;luke&#x2F;centos_habor:v1</span><br><span class="line"></span><br><span class="line">4.4 登录仓库</span><br><span class="line">[root@instance-x0nj9foj harbor]# docker login 192.168.224.11</span><br><span class="line"></span><br><span class="line">Username: admin</span><br><span class="line"></span><br><span class="line">Password: luke123</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4.5 上传镜像文件</span><br><span class="line">docker push 192.168.224.11&#x2F;luke&#x2F;centos_habor:v1</span><br><span class="line"></span><br><span class="line">4.6 web登录镜像仓库进行确认</span><br></pre></td></tr></table></figure>





<h3 id="4-Docker的网络"><a href="#4-Docker的网络" class="headerlink" title="4.Docker的网络"></a><strong>4.Docker的网络</strong></h3><h4 id="1-网络的分类"><a href="#1-网络的分类" class="headerlink" title="1.网络的分类"></a><strong>1.网络的分类</strong></h4><p><strong>单机</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Bridge Network 桥接网络</span><br><span class="line"></span><br><span class="line">Host Network   公用主机网络和宿主机一个网络</span><br><span class="line"></span><br><span class="line">None Network   本地网络，自己和自己玩</span><br></pre></td></tr></table></figure>

<p><strong>多机</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Overlay Network </span><br><span class="line">做集群的时候用。</span><br></pre></td></tr></table></figure>

<h4 id="2-Linux-网络命名空间namespace"><a href="#2-Linux-网络命名空间namespace" class="headerlink" title="2.Linux 网络命名空间namespace"></a><strong>2.Linux 网络命名空间namespace</strong></h4><p><strong>命名空间是docker底层重要的概念</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">列出网络名</span><br><span class="line">ip netns list </span><br><span class="line"></span><br><span class="line">增加一个网络名</span><br><span class="line">ip netns add  test1</span><br><span class="line"></span><br><span class="line">删除一个网络</span><br><span class="line">ip netns delete  test1 </span><br><span class="line"></span><br><span class="line">查看新建的网络的状态 刚开始是DOWN</span><br><span class="line">ip netns exec test1 ip a </span><br><span class="line"></span><br><span class="line">设置test1网络的状态，现在变成了UNKNOWN</span><br><span class="line">ip netns exec test1 ip link set dev lo up </span><br><span class="line"></span><br><span class="line">命名空间至少需要两个以上才能连接起来</span><br><span class="line">在添加一个</span><br><span class="line">ip netns add   test2  </span><br><span class="line"></span><br><span class="line">添加veth peer veth 对</span><br><span class="line">ip link add veth-test1 type veth peer name veth-test2</span><br><span class="line"></span><br><span class="line">查看veth对</span><br><span class="line">ip link  </span><br><span class="line"></span><br><span class="line">把veth-test1 加入到 test1网络</span><br><span class="line">ip link set veth-test1 netns test1   </span><br><span class="line"></span><br><span class="line">查看test1的link状态.</span><br><span class="line">ip netns exec test1 ip link  </span><br><span class="line"></span><br><span class="line">把veth-test2加入到test2网络 </span><br><span class="line">ip link set veth-test2 netns test2</span><br><span class="line"></span><br><span class="line">给test1网络添加ip</span><br><span class="line">ip netns exec test1 ip addr add 172.17.0.2&#x2F;24 dev veth-test1 </span><br><span class="line">给test2网络添加ip</span><br><span class="line">ip netns exec test2 ip addr add 172.17.0.3&#x2F;24 dev veth-test2</span><br><span class="line"></span><br><span class="line">在查看状态test1命名空间的</span><br><span class="line">ip netns exec test1 ip link</span><br><span class="line"></span><br><span class="line">启动test1,指定veth对</span><br><span class="line">ip netns exec test1 ip link set dev veth-test1 up  </span><br><span class="line">启动test2,指定veth对</span><br><span class="line">ip netns exec test2 ip link set dev veth-test2 up </span><br><span class="line"></span><br><span class="line"> 查看test1网络的IP</span><br><span class="line">ip netns exec test1 ip a </span><br><span class="line"></span><br><span class="line">test1网络去ping test2的ip</span><br><span class="line">ip netns exec test1 ping 172.17.0.3 </span><br><span class="line"></span><br><span class="line">test2网络去ping test1的ip</span><br><span class="line">ip netns exec test2 ping 172.17.0.2</span><br></pre></td></tr></table></figure>

<h4 id="3-Bridge-详解"><a href="#3-Bridge-详解" class="headerlink" title="3.Bridge 详解"></a><strong>3.Bridge 详解</strong></h4><p>进行多容器通信</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">查看支持的网络</span><br><span class="line">docker network ls</span><br><span class="line">查看网络id的数据信息</span><br><span class="line">docker network inspect 6343c0e76790</span><br><span class="line"></span><br><span class="line">查看registry容器的网络信息</span><br><span class="line">docker exec registry ip a</span><br><span class="line">eth0@if26   用ip a命令查看 26: vetha30904a@if25:   这个if25和if26就是veth对</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">yum install -y bridge-utils  下载这个工具</span><br><span class="line">brctl show 查看桥接网络和容器的veth对</span><br><span class="line"> brctl show</span><br><span class="line">bridge name	bridge id		STP enabled	interfaces</span><br><span class="line">docker0		8000.02423025af29	no		veth33d7deb</span><br><span class="line">							vetha30904a</span><br></pre></td></tr></table></figure>



<h4 id="4-容器通信"><a href="#4-容器通信" class="headerlink" title="4.容器通信"></a><strong>4.容器通信</strong></h4><p>有时写代码时，并不知道要请求的IP地址 </p>
<h5 id="1-–link-lt-name-or-id-gt-alias"><a href="#1-–link-lt-name-or-id-gt-alias" class="headerlink" title="1. –link &lt;name or id&gt;:alias"></a><strong>1. –link &lt;name or id&gt;:alias</strong></h5><pre><code>   其中，name和id是源容器的name和id，alias是源容器在link下的别名。</code></pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1.启动一个容器命名为mycentos2</span><br><span class="line">docker run -it --name mycentos2 --restart&#x3D;always -d centos</span><br><span class="line"></span><br><span class="line">2.再启动一个容器mycentos3 --link 链接到mycentos2</span><br><span class="line">docker run -it --name mycentos3 --restart&#x3D;always --link mycentos2  -d centos</span><br><span class="line"></span><br><span class="line">这时候进去mycentos3里面，docker exec -it mycentos3 &#x2F;bin&#x2F;bash</span><br><span class="line">就可以直接ping mycentos2 可以直接ping通了。不用输入ip地址，但是进去mycentos2里面不能通过容器名ping通mycentos3这个容器，只能ip才可以ping</span><br><span class="line"></span><br><span class="line">3.在启动一个容器，进行多个容器链接。</span><br><span class="line">docker run -it --name mycentos4 --restart&#x3D;always --link mycentos2:centos2 --link mycentos3:centos3  -d centos</span><br><span class="line"></span><br><span class="line">进入容器 docker exec -it mycentos4 &#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line">ping mycentos2 或者ping centos2</span><br><span class="line">ping mycentos3  或者ping centos3 都可以ping通</span><br></pre></td></tr></table></figure>

<h5 id="2-创建网络-推荐"><a href="#2-创建网络-推荐" class="headerlink" title="2.创建网络(推荐)"></a><strong>2.创建网络(推荐)</strong></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">docker network ls</span><br><span class="line"></span><br><span class="line">创建网络</span><br><span class="line"></span><br><span class="line">docker network create -d bridge my-bridge</span><br><span class="line"></span><br><span class="line">-d 后面第一个bridge是网络的连接方式，第二个my-bridge是自己起的网络的名字</span><br><span class="line"></span><br><span class="line">如何创建镜像同时连上主容器的某个网络上？</span><br><span class="line"></span><br><span class="line">在镜像创建时指定network 的name ,可以通过docker network ls查看到所有的网络，如下面实例</span><br><span class="line"></span><br><span class="line">docker run -it --name test1 --restart&#x3D;always  --network my-bridge -d centos</span><br><span class="line"></span><br><span class="line">如何查看是否连上了呢?</span><br><span class="line"></span><br><span class="line">docker network inspect+ 网络的名字 my-bridge</span><br><span class="line"></span><br><span class="line">如何手动将网络和容器连接呢？</span><br><span class="line"></span><br><span class="line">docker network connect my-bridage mycentos4</span><br><span class="line">docker network connect my-bridge  mycentos3</span><br><span class="line">docker network connect my-bridge  mycentos2</span><br><span class="line">这时候进去test1 就可以ping mycentos4了。同时mycentos4里面也可以通过ping test1来ping通</span><br><span class="line">docker exec  -it test1 &#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line">这时他们几个容器都可以互相ping通</span><br><span class="line"></span><br><span class="line">通过将test2和test3同时连上自己的创建的网络（注意是自己创建的网络，不是系统自己默认的网络）,这样双方都可以通过名字互ping上</span><br></pre></td></tr></table></figure>





<h4 id="5-端口映射"><a href="#5-端口映射" class="headerlink" title="5.端口映射"></a><strong>5.端口映射</strong></h4><p>实现外界访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1. -p 8080:80  把容器的80端口映射到主机的8080端口</span><br><span class="line">docker run -it --name web --restart&#x3D;always  -p 8080:80  --network my-bridge -d nginx</span><br><span class="line">这时候访问主机的8080端口就可以访问内部的80端口了。</span><br><span class="line">http:&#x2F;&#x2F;192.168.224.11:8080&#x2F;</span><br><span class="line"></span><br><span class="line">2. -p ip:8081:80   把容器的80端口映射到主机指定的ip端口</span><br><span class="line">docker run -it --name nginx2 --restart&#x3D;always  -p 192.168.224.11:8081:80  --network my-bridge -d nginx</span><br><span class="line">这样就只能通过指定ip:端口才可以访问了，</span><br><span class="line"></span><br><span class="line">3.随机端口映射(32768-60999)</span><br><span class="line">-p 80 把容器的80端口映射到主机的随机端口</span><br><span class="line">docker run -it --name web2 --restart&#x3D;always  -p 80  --network my-bridge -d nginx</span><br><span class="line"></span><br><span class="line">4. udp端口映射 把容器的udp端口映射到主机端口</span><br><span class="line">-p 82:53&#x2F;udp </span><br><span class="line"></span><br><span class="line">5. 多个端口映射 -p 8080:80 -p 33060:3306 -p 2222:22</span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/08/04/aw6FwF.png" alt="aw6FwF.png"></p>
<h4 id="6-网络的none和host"><a href="#6-网络的none和host" class="headerlink" title="6.网络的none和host"></a><strong>6.网络的none和host</strong></h4><p>none 应用场景:安全性要求极高，存储绝密数据等</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">指定网络模式为none </span><br><span class="line">docker run -it --name none1 --restart&#x3D;always  --network none -d centos</span><br><span class="line"></span><br><span class="line">这里面只有127.0.0.1这个ip ,只能ping通自己，其他都不能ping通</span><br></pre></td></tr></table></figure>

<p>host网络</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name host1 --restart&#x3D;always  --network host -d centos</span><br><span class="line"></span><br><span class="line">网络和宿主机一样。</span><br></pre></td></tr></table></figure>





<h4 id="7-多容器部署和应用"><a href="#7-多容器部署和应用" class="headerlink" title="7.多容器部署和应用"></a><strong>7.多容器部署和应用</strong></h4><p>flask 做web服务，redis做自增</p>
<h4 id="8-多机器多容器通信"><a href="#8-多机器多容器通信" class="headerlink" title="8.多机器多容器通信"></a><strong>8.多机器多容器通信</strong></h4><h5 id="1-利用etcd实现多机的ip管理"><a href="#1-利用etcd实现多机的ip管理" class="headerlink" title="1.利用etcd实现多机的ip管理"></a><strong>1.利用etcd实现多机的ip管理</strong></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">etcd</span><br><span class="line">思路: </span><br><span class="line">下载etcd</span><br><span class="line">wget https:&#x2F;&#x2F;github.com&#x2F;coreos&#x2F;etcd&#x2F;releases&#x2F;download&#x2F;v3.0.12&#x2F;etcd-v3.0.12-linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">etcd启动命令(node01) 注意修改ip</span><br><span class="line">nohup .&#x2F;etcd --name docker-node1 --initial-advertise-peer-urls http:&#x2F;&#x2F;192.168.224.11:2380 \</span><br><span class="line">--listen-peer-urls http:&#x2F;&#x2F;192.168.224.11:2380 \</span><br><span class="line">--listen-client-urls http:&#x2F;&#x2F;192.168.224.11:2379,http:&#x2F;&#x2F;127.0.0.1:2379 \</span><br><span class="line">--advertise-client-urls http:&#x2F;&#x2F;192.168.224.11:2379 \</span><br><span class="line">--initial-cluster-token etcd-cluster \</span><br><span class="line">--initial-cluster docker-node1&#x3D;http:&#x2F;&#x2F;192.168.224.11:2380,docker-node2&#x3D;http:&#x2F;&#x2F;192.168.224.12:2380 \</span><br><span class="line">--initial-cluster-state new&amp;</span><br><span class="line"></span><br><span class="line">etcd启动命令(node02) 注意修改ip</span><br><span class="line">nohup .&#x2F;etcd --name docker-node2 --initial-advertise-peer-urls http:&#x2F;&#x2F;192.168.224.12:2380 \</span><br><span class="line">--listen-peer-urls http:&#x2F;&#x2F;192.168.224.12:2380 \</span><br><span class="line">--listen-client-urls http:&#x2F;&#x2F;192.168.224.12:2379,http:&#x2F;&#x2F;127.0.0.1:2379 \</span><br><span class="line">--advertise-client-urls http:&#x2F;&#x2F;192.168.224.12:2379 \</span><br><span class="line">--initial-cluster-token etcd-cluster \</span><br><span class="line">--initial-cluster docker-node1&#x3D;http:&#x2F;&#x2F;192.168.224.11:2380,docker-node2&#x3D;http:&#x2F;&#x2F;192.168.224.12:2380 \</span><br><span class="line">--initial-cluster-state new&amp;</span><br><span class="line"></span><br><span class="line">参数说明： </span><br><span class="line">● –data-dir 指定节点的数据存储目录，若不指定，则默认是当前目录。这些数据包括节点ID，集群ID，集群初始化配置，Snapshot文件，若未指 定–wal-dir，还会存储WAL文件 </span><br><span class="line">● –wal-dir 指定节点的was文件存储目录，若指定了该参数，wal文件会和其他数据文件分开存储 </span><br><span class="line">● –name 节点名称 </span><br><span class="line">● –initial-advertise-peer-urls 告知集群其他节点的URL，tcp2380端口用于集群通信 </span><br><span class="line">● –listen-peer-urls 监听URL，用于与其他节点通讯 </span><br><span class="line">● –advertise-client-urls 告知客户端的URL, 也就是服务的URL，tcp2379端口用于监听客户端请求 </span><br><span class="line">● –initial-cluster-token 集群的ID </span><br><span class="line">● –initial-cluster 集群中所有节点 </span><br><span class="line">● –initial-cluster-state 集群状态，new为新创建集群，existing为已存在的集群</span><br><span class="line"></span><br><span class="line">查看端口有没有正常起来</span><br><span class="line">netstat -putnel</span><br><span class="line">查看集群状态</span><br><span class="line">.&#x2F;etcdctl cluster-health</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker启动命令(node01) 先停止下docker</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;dockerd  -H tcp:&#x2F;&#x2F;0.0.0.0:2375 -H unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;docker.sock --cluster-store&#x3D;etcd:&#x2F;&#x2F;192.168.224.11:2379 --cluster-advertise&#x3D;192.168.224.11:2375&amp;</span><br><span class="line"></span><br><span class="line">docker启动命令(node02) 先停止下docker</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;dockerd  -H tcp:&#x2F;&#x2F;0.0.0.0:2375 -H unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;docker.sock --cluster-store&#x3D;etcd:&#x2F;&#x2F;192.168.224.12:2379 --cluster-advertise&#x3D;192.168.224.12:2375&amp;</span><br><span class="line"></span><br><span class="line">测试下集群网络</span><br><span class="line">在node01节点创建overlay网络，名为demo</span><br><span class="line">docker network create -d overlay demo</span><br><span class="line"></span><br><span class="line">这时候去node2节点看docker network ls 查看是否也有demo这个网络，有就说明可以了</span><br><span class="line"></span><br><span class="line">开始在node01运行容器</span><br><span class="line">docker run -it --name test1 --restart&#x3D;always --net demo -d centos</span><br><span class="line"></span><br><span class="line">在node02运行一台，容器名不要和node01的重复</span><br><span class="line">docker run -it --name test2 --restart&#x3D;always --net demo -d centos</span><br><span class="line"></span><br><span class="line">这时候进去容器。两台机器上的容器都可以互相ping通了</span><br><span class="line">docker exec  -it test1 &#x2F;bin&#x2F;bash</span><br><span class="line">ping test2</span><br></pre></td></tr></table></figure>

<h5 id="2-利用consul服务管理"><a href="#2-利用consul服务管理" class="headerlink" title="2.利用consul服务管理"></a><strong>2.利用consul服务管理</strong></h5><p>方法一</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">1.启动 consul服务，实现网络的统一配置管理</span><br><span class="line">docker run --name consul -p 8500:8500 -h consul -d progrium&#x2F;consul -server -bootstrap</span><br><span class="line"></span><br><span class="line">consul: kv类型的存储数据库(key:value)</span><br><span class="line">docker01和docker02服务器上:</span><br><span class="line">vim &#x2F;etc&#x2F;docker&#x2F;daemon.json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">&quot;live-restore&quot;:true ,</span><br><span class="line">&quot;host&quot;:[&quot;tcp:&#x2F;&#x2F;0.0.0.0:2376&quot;,&quot;unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;docker.sock&quot;],</span><br><span class="line">&quot;cluster-store&quot;:&quot;consul:&#x2F;&#x2F;192.168.224.11:8500&quot;,</span><br><span class="line">&quot;cluster-advertise&quot;:&quot;ens33:2376&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cluster-store：配置的Consul的leader地址，单体直接写，其它软件注意协议</span><br><span class="line">cluster-advertise: 指定监听的网卡和端口，也可以指定接收订阅消息的IP:PORT</span><br><span class="line"></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br><span class="line"></span><br><span class="line">2. 创建overlay网络</span><br><span class="line">docker network create -d overlay --subnet 172.16.0.0&#x2F;24 --gateway 172.16.0.254 over_1</span><br><span class="line">docker network ls  会发现两台服务器上都多了一个网络over_1</span><br><span class="line"></span><br><span class="line">3. 启动容器测试</span><br><span class="line">docker run -it --name luke01 -h luke1  --network over_1 -d centos </span><br><span class="line"></span><br><span class="line">docker run -it --name luke02  -h luke2 --network over_1 -d centos</span><br><span class="line"></span><br><span class="line">进入容器测试</span><br><span class="line">docker container exec -it luke01 &#x2F;bin&#x2F;bash</span><br><span class="line">ping luke02  可以ping通 他们都可以互相ping通</span><br><span class="line">每个容器有两块网卡，eth0实现容器间的通讯，eth1实现容器访问外网 容器默认路由是走eth1。docker会创建一个bridge网络“docker_gwbridge”，为所有连接到overlay网络的容器提供访问外网的能力 ：</span><br></pre></td></tr></table></figure>

<p>方法二</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">1.网卡名ens33</span><br><span class="line">vim &#x2F;etc&#x2F;docker&#x2F;daemon.json</span><br><span class="line">&#123;</span><br><span class="line"> &quot;live-restore&quot;:true ,</span><br><span class="line">&quot;cluster-store&quot;:&quot;consul:&#x2F;&#x2F;192.168.224.11:8500&quot;,</span><br><span class="line">&quot;cluster-advertise&quot;:&quot;ens33:2376&quot;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">接着执行命令，重启docker服务，另一台服务器操作方式相同，注意网卡名称</span><br><span class="line">sudo systemctl daemon-reload &amp;&amp; sudo systemctl restart docker</span><br><span class="line"></span><br><span class="line">2.在11上启动consul</span><br><span class="line">docker run --name consul -p 8500:8500 -h consul   -d consul:1.5.2</span><br><span class="line"></span><br><span class="line">3.创建Docker overlay共享网络</span><br><span class="line">$ docker network create -d overlay my_overlay</span><br><span class="line"></span><br><span class="line">访问192.168.224.11:8500</span><br><span class="line">key&#x2F;value 会出现相关节点信息</span><br><span class="line"></span><br><span class="line">4. 启动容器测试</span><br><span class="line">docker run -it --name luke01 -h luke1  --network my_overlay -d centos </span><br><span class="line"></span><br><span class="line">docker run -it --name luke02  -h luke2 --network my_overlay -d centos</span><br><span class="line"></span><br><span class="line">进入容器测试</span><br><span class="line">docker container exec -it luke01 &#x2F;bin&#x2F;bash</span><br><span class="line">ping luke02  可以ping通 他们都可以互相ping通</span><br><span class="line">每个容器有两块网卡，eth0实现容器间的通讯，eth1实现容器访问外网 容器默认路由是走eth1。docker会创建一个bridge网络“docker_gwbridge”，为所有连接到overlay网络的容器提供访问外网的能力 ：</span><br></pre></td></tr></table></figure>





<h3 id="5-docker容器数据持久化本地挂载"><a href="#5-docker容器数据持久化本地挂载" class="headerlink" title="5.docker容器数据持久化本地挂载"></a><strong>5.docker容器数据持久化本地挂载</strong></h3><p><strong>1.数据持久化引入</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">官方mysql数据存储文档</span><br><span class="line">https:&#x2F;&#x2F;hub.docker.com&#x2F;_&#x2F;mysql</span><br></pre></td></tr></table></figure>

<ol>
<li><p>在主机系统上的适当卷上创建数据目录，例如<code>/my/own/datadir</code>。</p>
</li>
<li><p><code>mysql</code>像这样启动容器：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name some-mysql -v &#x2F;my&#x2F;own&#x2F;datadir:&#x2F;var&#x2F;lib&#x2F;mysql -e MYSQL_ROOT_PASSWORD&#x3D;my-secret-pw -d mysql</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>该<code>-v /my/own/datadir:/var/lib/mysql</code>命令的一部分<code>/my/own/datadir</code>从底层主机系统<code>/var/lib/mysql</code>在容器内部安装目录，默认情况下，MySQL将在该目录中写入其数据文件。</p>
<p><strong>2.数据卷容器</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1.宿主机模拟数据目录</span><br><span class="line">mkdir -p &#x2F;opt&#x2F;volume&#x2F;a</span><br><span class="line">mkdir -p &#x2F;opt&#x2F;volume&#x2F;b</span><br><span class="line">touch &#x2F;opt&#x2F;volume&#x2F;a&#x2F;a.txt</span><br><span class="line">touch &#x2F;opt&#x2F;volume&#x2F;b&#x2F;b.txt</span><br><span class="line"></span><br><span class="line">2.启动数据卷容器</span><br><span class="line">docker container run  -it --restart&#x3D;always --name nginx_volumes -v &#x2F;opt&#x2F;volume&#x2F;a:&#x2F;opt&#x2F;a -v &#x2F;opt&#x2F;volume&#x2F;b:&#x2F;opt&#x2F;b -d centos</span><br><span class="line"></span><br><span class="line">3.使用数据卷容器</span><br><span class="line">docker run -d -p 8085:80 --volumes-from nginx_volumes --restart&#x3D;always  --name nginx_5 nginx</span><br><span class="line"></span><br><span class="line">docker run -d -p 8086:80 --volumes-from nginx_volumes --restart&#x3D;always  --name nginx_6 nginx</span><br><span class="line"></span><br><span class="line">这样有多个目录需要挂载就可以使用这种方式。</span><br><span class="line">作用: 在集中管理集群中。大批量的容器都需要挂载相同的多个数据卷时，可以采用数据卷容器进行统一管理。</span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/08/04/aw6nQx.png" alt="aw6nQx.png"></p>
<h3 id="6，volume卷管理"><a href="#6，volume卷管理" class="headerlink" title="6，volume卷管理"></a><strong>6，volume卷管理</strong></h3><p>docker volume 可以理解成一个container中的磁盘,既可以跟随container的生命周期（在Dockerfile 中定义使用VOLUME关键字），也可以单独创建，永久存储，直到用docker volume rm 命令删除。</p>
<p><strong>1.查看volume</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume ls</span><br></pre></td></tr></table></figure>

<p><strong>2.创建volume</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker volume create [options] 卷名 </span><br><span class="line">options选项有两个参数</span><br><span class="line">	-d  指定存储设备，默认是local </span><br><span class="line">	-o  直接卷的存储路径 默认是 map[]</span><br><span class="line">示例1: </span><br><span class="line">	docker volume create -d local-persist -o mountpoint&#x3D;&#x2F;data&#x2F;nginx --name&#x3D;nginxroot</span><br><span class="line">示例2: 参数默认</span><br><span class="line"> 	docker volume create vo_logs </span><br><span class="line"> 	这时候卷的存放路径是&#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes&#x2F;vo_logs&#x2F;_data</span><br></pre></td></tr></table></figure>

<p>  <strong>3.查看volume的详细信息</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume inspect vo_logs</span><br></pre></td></tr></table></figure>

<p><strong>4.删除卷</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker volume rm -f vo_logs</span><br><span class="line"> -f 表示强制删除</span><br><span class="line"> </span><br><span class="line">docker volume prune [options]</span><br><span class="line">删除未被任何容器使用的本地卷 </span><br><span class="line">--filter 提供过滤值</span><br><span class="line">-f , --force  不提示确认信息，直接删除</span><br></pre></td></tr></table></figure>

<p><strong>5.卷的使用</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -t --name mysql --restart&#x3D;always -p 3306:3306 -v myvoluem:&#x2F;var&#x2F;lib&#x2F;mysql -e MYSQL_ROOT_PASSWORD&#x3D;mypassword -d mysql</span><br><span class="line"></span><br><span class="line">这时候容器里的&#x2F;var&#x2F;lib&#x2F;mysql的数据就存在myvoluem这个数据卷里了，</span><br><span class="line"></span><br><span class="line">第二种是本地挂载</span><br><span class="line">绑定宿主目录的概念很容易理解，就是将宿主目录绑定到容器中的某个目录位置。这样容器可以直接访问宿主目录的文件。其形式是</span><br><span class="line">docker run --name some-mysql -v &#x2F;my&#x2F;own&#x2F;datadir:&#x2F;var&#x2F;lib&#x2F;mysql -e MYSQL_ROOT_PASSWORD&#x3D;my-secret-pw -d mysql</span><br></pre></td></tr></table></figure>

<p>挂载nginx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.创建nginx家目录存储卷</span><br><span class="line">docker volume create -d local-persist -o mountpoint&#x3D;&#x2F;data&#x2F;nginx --name&#x3D;nginxroot</span><br><span class="line">2.创建nginx配置目录存储卷</span><br><span class="line"> docker volume create -d local-persist -o mountpoint&#x3D;&#x2F;data&#x2F;nginxconf --name&#x3D;nginxconf</span><br><span class="line"> </span><br><span class="line">3.启动容器并挂载卷</span><br><span class="line"> docker run -it --name nginx1 --restart&#x3D;always -p 8080:80 -v nginxroot:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html -v nginxconf:&#x2F;etc&#x2F;nginx -d nginx</span><br><span class="line"> </span><br><span class="line">4.这时候修改配置文件就可以直接在物理机修改就可以了</span><br></pre></td></tr></table></figure>





<p><strong>6.卷和挂载目录有什么区别？</strong></p>
<p>卷 (Docker Volume) 是受控存储，是由 Docker 引擎进行管理维护的。因此使用卷，你可以不必处理 uid、SELinux 等各种权限问题，Docker 引擎在建立卷时会自动添加安全规则，以及根据挂载点调整权限。并且可以统一列表、添加、删除。另外，除了本地卷外，还支持网络卷、分布式卷。</p>
<p>而挂载目录那就没人管了，属于用户自行维护。你就必须手动处理所有权限问题。特别是在 CentOS 上，很多人碰到 Permission Denied，就是因为没有使用卷，而是挂载目录，而且还对 SELinux 安全权限一无所知导致。</p>
<h2 id="3-docker-compose-多容器部署"><a href="#3-docker-compose-多容器部署" class="headerlink" title="3,docker-compose 多容器部署"></a><strong>3,docker-compose 多容器部署</strong></h2><h3 id="1-安装"><a href="#1-安装" class="headerlink" title="1.安装"></a><strong>1.安装</strong></h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">方法一：</span><br><span class="line">curl -L https://github.com/docker/compose/releases/download/1.26.0/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose</span><br><span class="line">或者：</span><br><span class="line">curl -L https://github.com/docker/compose/releases/download/1.21.2/docker-compose-$(uname -s)-$(uname -m) -o /usr/local/bin/docker-compose</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">chmod +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>

<p>查看版本信息</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># docker-compose --version</span><br></pre></td></tr></table></figure>

<p>但是此方法会经常因为网络的原因而无法安装 </p>
<p>方法二：</p>
<p>1、安装python-pip</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -y install epel-release</span><br><span class="line"></span><br><span class="line">yum -y install python-pip</span><br></pre></td></tr></table></figure>

<p>2、安装docker-compose</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install docker-compose</span><br></pre></td></tr></table></figure>

<p>待安装完成后，执行查询版本的命令，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose version</span><br></pre></td></tr></table></figure>

<h3 id="2-docker-compose用法"><a href="#2-docker-compose用法" class="headerlink" title="2.docker-compose用法"></a><strong>2.docker-compose用法</strong></h3><p><strong>官方文档</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;docs.docker.com&#x2F;compose&#x2F;</span><br></pre></td></tr></table></figure>



<p>常用选项：</p>
<p>–verbose：输出更多的调试信息</p>
<p>–version：查看compose的版本</p>
<p>-f –file FILE：使用特定的compose模板文件，默认为docker-compose.yml。</p>
<p>-p –project-name NAME 指定项目名称，默认使用目录名称。</p>
<p>常用命令：</p>
<p>down: 停止并删除容器、网络、镜像和卷</p>
<p>build：构建或重建服务</p>
<p>ps：查看已经启动的服务状态    </p>
<p>kill：停止某个服务、杀掉容器    </p>
<p>logs：可以查看某个服务的log、显示容器的输出内容    </p>
<p>port：打印绑定的public port（开放端口）     </p>
<p>pull：拉取服务镜像    </p>
<p>up：启动yml定义的所有服务   </p>
<p>stop：停止yml中定义的所有服务    </p>
<p>start：启动被停止的yml中的所有服务     </p>
<p>kill：强行停止yml中定义的所有服务     </p>
<p>rm：删除yml中定义的所有服务    </p>
<p>restart：重启yml中定义的所有服务     </p>
<p>scale：设置服务的容器数目</p>
<p>run:运行一个一次性命令</p>
<p>docker-compose up -d nginx           构建建启动nignx容器 在后台运行</p>
<p>docker-compose exec nginx bash      登录到nginx容器中</p>
<p>docker-compose down               删除所有容器,镜像</p>
<p>docker-compose ps                  显示所有容器</p>
<p>docker-compose restart nginx          重新启动nginx容器</p>
<p>docker-compose run –no-deps –rm php-fpm php -v 在php-fpm中不启动关联容器，并容器执行php -v 执行完成后删除容器</p>
<p>docker-compose build nginx           构建镜像 。    </p>
<p>docker-compose build –no-cache nginx  不带缓存的构建。</p>
<p>docker-compose logs nginx           查看nginx的日志 </p>
<p>docker-compose logs -f nginx          查看nginx的实时日志</p>
<h3 id="3-YAML简介"><a href="#3-YAML简介" class="headerlink" title="3.YAML简介"></a><strong>3.YAML简介</strong></h3><p>​    Yaml简介.YAML是一种标记语言,可读性很强。类似于XML数据描述语言,语法比XML简单的多。YAML数据结构通过缩进来表示,连续的项目通过减号来表示,键值对用冒号分割,数组用括号括起来, hash用花括号括起来。</p>
<p><strong>YAML文件格式注意事项:</strong></p>
<p>在缩排中空白字符的数目并不是非常重要,只要相同阶层的元素左侧对齐就可以了(不过不能使用TAB字符);</p>
<p>通常开头缩进2个空格;字符的后面缩进1个空格,比如冒号、逗号、横杆;</p>
<p>支持#注释；</p>
<p>允许在文件中加入选择性的空行,以增加可读性;</p>
<p>可以看到一份标准配置文件应该包含 version、services、networks、volumes 四大部分，其中最关键的就是 services 和 networks 两个部分，下面先来看 services 的书写规则。</p>
<p><strong>示例：</strong>创建4台centos容器。在同一个网络，有挂载。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">version: &#39;3&#39;</span><br><span class="line">services:</span><br><span class="line">  centos:</span><br><span class="line">    image: centos</span><br><span class="line">    restart: always</span><br><span class="line">    hostname: centos</span><br><span class="line">    container_name: centos</span><br><span class="line">    ports:</span><br><span class="line">      - 80:80</span><br><span class="line">    networks: </span><br><span class="line">      - nginx</span><br><span class="line">  centos1:</span><br><span class="line">    image: centos</span><br><span class="line">    restart: always</span><br><span class="line">    hostname: centos1</span><br><span class="line">    container_name: centos1</span><br><span class="line">    networks:</span><br><span class="line">      - nginx</span><br><span class="line">    command:</span><br><span class="line">      - yum install -y epel-release &amp;&amp; yum install -y nginx</span><br><span class="line">    volumes:</span><br><span class="line">      - nginx:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html</span><br><span class="line">      - nginx:&#x2F;etc&#x2F;nginx</span><br><span class="line">  centos2:</span><br><span class="line">    image: centos</span><br><span class="line">    restart: always</span><br><span class="line">    hostname: centos2</span><br><span class="line">    container_name: centos2</span><br><span class="line">    networks:</span><br><span class="line">      - nginx</span><br><span class="line">  centos3:</span><br><span class="line">    image: centos</span><br><span class="line">    restart: always</span><br><span class="line">    hostname: centos3</span><br><span class="line">    container_name: centos3</span><br><span class="line">    networks:</span><br><span class="line">      - nginx</span><br><span class="line">networks:</span><br><span class="line">  nginx:</span><br><span class="line">    driver: bridge</span><br><span class="line">volumes:</span><br><span class="line">  nginx:</span><br><span class="line">    driver: local-persist</span><br><span class="line">    driver_opts:</span><br><span class="line">      mountpoint: &#x2F;data&#x2F;nginx</span><br></pre></td></tr></table></figure>





<h3 id="4-docker-compose中YAML常用的字段："><a href="#4-docker-compose中YAML常用的字段：" class="headerlink" title="4.docker-compose中YAML常用的字段："></a><strong>4.docker-compose中YAML常用的字段：</strong></h3><table>
<thead>
<tr>
<th>字段</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>version: ‘3’</td>
<td>表示当前yaml文件版本</td>
</tr>
<tr>
<td>build dockerfile context</td>
<td>指定dockerfile文件名构建镜像上下文路径</td>
</tr>
<tr>
<td>services</td>
<td>相当于容器服务</td>
</tr>
<tr>
<td>image</td>
<td>指定镜像</td>
</tr>
<tr>
<td>restart</td>
<td>重启策略，默认no，always|on-failurel|unless-stopped</td>
</tr>
<tr>
<td>hostname</td>
<td>容器主机名</td>
</tr>
<tr>
<td>command</td>
<td>执行命令，覆盖默认命令</td>
</tr>
<tr>
<td>container_name</td>
<td>指定容器名称，由于容器名称是唯一的，如果指定自定义名称，则无法scale</td>
</tr>
<tr>
<td>ports</td>
<td>暴漏端口，与-p相同，但端口不能低于60</td>
</tr>
<tr>
<td>environment</td>
<td>添加环境变量</td>
</tr>
<tr>
<td>networks</td>
<td>加入网络，引用顶级networks下条目</td>
</tr>
<tr>
<td>extra_hosts</td>
<td>添加主机名的标签，就是往/etc/hosts文件中添加一些记录，与Docker client的–add-host类似：</td>
</tr>
<tr>
<td>volumes</td>
<td>挂载宿主机路径或命名卷在顶级volumes定义卷名称</td>
</tr>
<tr>
<td>deploy</td>
<td>指定部署和运行服务相关配置，只能在Swarm模式使用</td>
</tr>
<tr>
<td>depends_on</td>
<td>这个标签解决了容器的依赖、启动先后的问题。</td>
</tr>
</tbody></table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Docker容器的重启策略如下：</span><br><span class="line">restart</span><br><span class="line">no，默认策略，在容器退出时不重启容器</span><br><span class="line">on-failure，在容器非正常退出时（退出状态非0），才会重启容器</span><br><span class="line">on-failure:3，在容器非正常退出时重启容器，最多重启3次</span><br><span class="line">always，在容器退出时总是重启容器</span><br><span class="line">unless-stopped，在容器退出时总是重启容器，但是不考虑在Docker守护进程启动时就已经停止了的容器</span><br></pre></td></tr></table></figure>

<p>关于networks</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    networks:</span><br><span class="line">      - my-bridge  #此容器用的my-bridge网络</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  my-bridge: 		#创建的网络名称</span><br><span class="line">    driver: bridge  #网络模式为桥接</span><br></pre></td></tr></table></figure>

<p>关于volumes</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">使用卷：</span><br><span class="line">  volumes:</span><br><span class="line">    - data01:&#x2F;var&#x2F;lib&#x2F;mysql</span><br><span class="line"></span><br><span class="line">创建卷:</span><br><span class="line">volumes:</span><br><span class="line">  data01:</span><br><span class="line">    driver: local-persist</span><br><span class="line">    driver_opts:</span><br><span class="line">      mountpoint: &#x2F;data&#x2F;a</span><br><span class="line">  data10:</span><br><span class="line">    driver: local-persist</span><br><span class="line">    driver_opts:</span><br><span class="line">      mountpoint: &#x2F;data&#x2F;b</span><br><span class="line"></span><br><span class="line">data01为卷的名字。 &#x2F;data&#x2F;a为卷的物理路径。</span><br></pre></td></tr></table></figure>





<p>示列 docker-compose -f docker-compose.yml up  启动</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line">version: &#39;3&#39;</span><br><span class="line">services:</span><br><span class="line">  zoo1:</span><br><span class="line">    image:  zookeeper</span><br><span class="line">    restart: unless-stopped</span><br><span class="line">    hostname: zoo1</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;2181:2181&quot;</span><br><span class="line">      - &quot;2881:2888&quot;</span><br><span class="line">      - &quot;3881:3888&quot;</span><br><span class="line">    container_name: zookeeper</span><br><span class="line">    networks:</span><br><span class="line">       zoo_net:</span><br><span class="line">          ipv4_address: 172.18.0.2</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - &quot;zoo1:172.18.0.2&quot;</span><br><span class="line">      - &quot;zoo2:172.18.0.3&quot;</span><br><span class="line">      - &quot;zoo3:172.18.0.4&quot;</span><br><span class="line">    volumes:</span><br><span class="line">      - &quot;&#x2F;root&#x2F;kafka&#x2F;zoo1data:&#x2F;data&quot;</span><br><span class="line">      - &quot;&#x2F;root&#x2F;kafka&#x2F;zoo1data_log:&#x2F;datalog&quot;</span><br><span class="line">    environment:</span><br><span class="line">      ZOO_MY_ID: 1</span><br><span class="line">      ZOO_SERVERS: server.1&#x3D;zoo1:2881:3881;2181 server.2&#x3D;zoo2:2882:3882;2181 server.3&#x3D;zoo3:2883:3883;2181</span><br><span class="line"></span><br><span class="line">  zoo2:</span><br><span class="line">    image:  zookeeper</span><br><span class="line">    restart: unless-stopped</span><br><span class="line">    hostname: zoo2</span><br><span class="line">    container_name: zookeeper2</span><br><span class="line">    networks:</span><br><span class="line">       zoo_net:</span><br><span class="line">          ipv4_address: 172.18.0.3</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - &quot;zoo1:172.18.0.2&quot;</span><br><span class="line">      - &quot;zoo2:172.18.0.3&quot;</span><br><span class="line">      - &quot;zoo3:172.18.0.4&quot;</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;2182:2181&quot;</span><br><span class="line">      - &quot;2882:2888&quot;</span><br><span class="line">      - &quot;3882:3888&quot;</span><br><span class="line">    volumes:</span><br><span class="line">      - &quot;&#x2F;root&#x2F;kafka&#x2F;zoo2data:&#x2F;data&quot;</span><br><span class="line">      - &quot;&#x2F;root&#x2F;kafka&#x2F;zoo2data_log:&#x2F;datalog&quot;</span><br><span class="line"></span><br><span class="line">    environment:</span><br><span class="line">      ZOO_MY_ID: 2</span><br><span class="line">      ZOO_SERVERS: server.1&#x3D;zoo1:2881:3881;2181 server.2&#x3D;zoo2:2882:3882;2181 server.3&#x3D;zoo3:2883:3883;2181</span><br><span class="line"></span><br><span class="line">  zoo3:</span><br><span class="line">    image:  zookeeper</span><br><span class="line">    restart: unless-stopped</span><br><span class="line">    hostname: zoo3</span><br><span class="line">    container_name: zookeeper3</span><br><span class="line">    networks:</span><br><span class="line">       zoo_net:</span><br><span class="line">          ipv4_address: 172.18.0.4</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - &quot;zoo1:172.18.0.2&quot;</span><br><span class="line">      - &quot;zoo2:172.18.0.3&quot;</span><br><span class="line">      - &quot;zoo3:172.18.0.4&quot;</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;2183:2181&quot;</span><br><span class="line">      - &quot;2883:2888&quot;</span><br><span class="line">      - &quot;3883:3888&quot;</span><br><span class="line">    volumes:</span><br><span class="line">      - &quot;&#x2F;root&#x2F;kafka&#x2F;zoo3data:&#x2F;data&quot;</span><br><span class="line">      - &quot;&#x2F;root&#x2F;kafka&#x2F;zoo3data_log:&#x2F;datalog&quot;</span><br><span class="line"></span><br><span class="line">    environment:</span><br><span class="line">      ZOO_MY_ID: 3</span><br><span class="line">      ZOO_SERVERS: server.1&#x3D;zoo1:2881:3881;2181 server.2&#x3D;zoo2:2882:3882;2181 server.3&#x3D;zoo3:2883:3883;2181</span><br><span class="line"></span><br><span class="line">  kafka1:</span><br><span class="line">    image: wurstmeister&#x2F;kafka</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;9092:9092&quot;</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - &quot;zoo1:172.18.0.2&quot;</span><br><span class="line">      - &quot;zoo2:172.18.0.3&quot;</span><br><span class="line">      - &quot;zoo3:172.18.0.4&quot;</span><br><span class="line">    networks:</span><br><span class="line">      - zoo_net</span><br><span class="line">    restart: always</span><br><span class="line"></span><br><span class="line">    environment:</span><br><span class="line">      KAFKA_ADVERTISED_HOST_NAME: 192.161.87.218                     ## 修改:宿主机IP</span><br><span class="line">      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT:&#x2F;&#x2F;192.161.87.218:9092    ## 修改:宿主机IP</span><br><span class="line">      KAFKA_ZOOKEEPER_CONNECT: &quot;zoo1:2181&quot;</span><br><span class="line">      KAFKA_ADVERTISED_PORT: 9092</span><br><span class="line">      KAFKA_BROKER_ID: 1</span><br><span class="line">      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 3</span><br><span class="line">    volumes:</span><br><span class="line">      - &quot;&#x2F;root&#x2F;kafka&#x2F;kafka1-data:&#x2F;kafka&quot;</span><br><span class="line">    depends_on:</span><br><span class="line">      - zoo1</span><br><span class="line">    container_name: kafka1</span><br><span class="line">  kafka2:</span><br><span class="line">    image: wurstmeister&#x2F;kafka</span><br><span class="line">    networks:</span><br><span class="line">      - zoo_net</span><br><span class="line">    restart: always</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;9093:9092&quot;</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - &quot;zoo1:172.18.0.2&quot;</span><br><span class="line">      - &quot;zoo2:172.18.0.3&quot;</span><br><span class="line">      - &quot;zoo3:172.18.0.4&quot;</span><br><span class="line">    volumes:</span><br><span class="line">      - &quot;&#x2F;root&#x2F;kafka&#x2F;kafka2-data:&#x2F;kafka&quot;</span><br><span class="line">    environment:</span><br><span class="line">      KAFKA_ADVERTISED_HOST_NAME: 192.161.87.218           ## 修改:宿主机IP</span><br><span class="line">      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT:&#x2F;&#x2F;192.161.87.218:9093   ## 修改:宿主机IP</span><br><span class="line">      KAFKA_ZOOKEEPER_CONNECT: &quot;zoo1:2181&quot;</span><br><span class="line">      KAFKA_ADVERTISED_PORT: 9093</span><br><span class="line">      KAFKA_BROKER_ID: 2</span><br><span class="line">      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 3</span><br><span class="line">    depends_on:</span><br><span class="line">      - zoo1</span><br><span class="line">    container_name: kafka2</span><br><span class="line">  kafka3:</span><br><span class="line">    image: wurstmeister&#x2F;kafka</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;9094:9092&quot;</span><br><span class="line">    restart: always</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - &quot;zoo1:172.18.0.2&quot;</span><br><span class="line">      - &quot;zoo2:172.18.0.3&quot;</span><br><span class="line">      - &quot;zoo3:172.18.0.4&quot;</span><br><span class="line">    volumes:</span><br><span class="line">      - &quot;&#x2F;root&#x2F;kafka&#x2F;kafka3-data:&#x2F;kafka&quot;</span><br><span class="line"></span><br><span class="line">    networks:</span><br><span class="line">      - zoo_net</span><br><span class="line">    environment:</span><br><span class="line">      KAFKA_ADVERTISED_HOST_NAME: 192.161.87.218          ## 修改:宿主机IP</span><br><span class="line">      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT:&#x2F;&#x2F;192.161.87.218:9094   ## 修改:宿主机IP</span><br><span class="line">      KAFKA_ZOOKEEPER_CONNECT: &quot;zoo1:2181&quot;</span><br><span class="line">      KAFKA_ADVERTISED_PORT: 9094</span><br><span class="line">      KAFKA_BROKER_ID: 3</span><br><span class="line">      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 3</span><br><span class="line">    depends_on:</span><br><span class="line">      - zoo1</span><br><span class="line">    container_name: kafka3</span><br><span class="line">  kafka4:</span><br><span class="line">    image: wurstmeister&#x2F;kafka</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;9095:9092&quot;</span><br><span class="line">    restart: always</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - &quot;zoo1:172.18.0.2&quot;</span><br><span class="line">      - &quot;zoo2:172.18.0.3&quot;</span><br><span class="line">      - &quot;zoo3:172.18.0.4&quot;</span><br><span class="line">    volumes:</span><br><span class="line">      - &quot;&#x2F;root&#x2F;kafka&#x2F;kafka4-data:&#x2F;kafka&quot;</span><br><span class="line"></span><br><span class="line">    networks:</span><br><span class="line">      - zoo_net</span><br><span class="line">    environment:</span><br><span class="line">      KAFKA_ADVERTISED_HOST_NAME: 192.161.87.218          ## 修改:宿主机IP</span><br><span class="line">      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT:&#x2F;&#x2F;192.161.87.218:9095   ## 修改:宿主机IP</span><br><span class="line">      KAFKA_ZOOKEEPER_CONNECT: &quot;zoo1:2181&quot;</span><br><span class="line">      KAFKA_ADVERTISED_PORT: 9095</span><br><span class="line">      KAFKA_BROKER_ID: 4</span><br><span class="line">      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 3</span><br><span class="line">    depends_on:</span><br><span class="line">      - zoo1</span><br><span class="line">    container_name: kafka4</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  kafka-manager:</span><br><span class="line">    image: sheepkiller&#x2F;kafka-manager              ## 镜像：开源的web管理kafka集群的界面</span><br><span class="line">    networks:</span><br><span class="line">      - zoo_net</span><br><span class="line">    environment:</span><br><span class="line">        ZK_HOSTS: 192.161.87.218                   ## 修改:宿主机IP</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;9000:9000&quot;                               ## 暴露端口</span><br><span class="line">    depends_on:</span><br><span class="line">      - kafka3</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  zoo_net:</span><br><span class="line">    ipam:</span><br><span class="line">      config:</span><br><span class="line">      - subnet: 172.18.0.0&#x2F;16</span><br></pre></td></tr></table></figure>

</div><ul class="post-copyright"><li><strong>本文标题：</strong><a href="https://yc6.cool/2020/08/04/docker使用/">docker的使用</a></li><li><strong>本文作者：</strong><a href="https://yc6.cool">yichen</a></li><li><strong>本文链接：</strong><a href="https://yc6.cool/2020/08/04/docker使用/">https://yc6.cool/2020/08/04/docker使用/</a></li><li><strong>版权声明：</strong><span>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！</span></li></ul><div><div class="recommend-post"><span class="is-size-6 has-text-grey has-mr-7"># 相关文章</span><br><span>  1.<a class="is-size-6" href="/2023/05/17/Kubernetes%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%83%A8%E7%BD%B2/" target="_blank">Kubernetes高可用集群二进制部署</a><br></span><span>  2.<a class="is-size-6" href="/2022/03/12/openresty%E7%BB%93%E5%90%88lua%E5%AF%B9%E5%90%8C%E4%B8%80%E6%9D%A1%E5%9F%9F%E5%90%8D%E5%88%A4%E6%96%AD%E5%8F%82%E6%95%B0%E5%81%9A%E8%B4%9F%E8%BD%BD/" target="_blank">openresty结合lua对域名参数做负载均衡</a><br></span><span>  3.<a class="is-size-6" href="/2021/07/31/nginx%E5%88%A4%E6%96%AD%E5%BE%AE%E4%BF%A1%E7%AB%AF%E8%B7%B3%E8%BD%AC%E4%B8%8D%E5%90%8C%E9%A1%B5%E9%9D%A2/" target="_blank">nginx判断微信端跳转不同页面</a><br></span><span>  4.<a class="is-size-6" href="/2020/09/30/nftables/" target="_blank">nftables</a><br></span><span>  5.<a class="is-size-6" href="/2020/08/04/k8s%E4%B8%ADYAML%E6%96%87%E4%BB%B6%E7%BC%96%E5%86%99%E4%B8%8E%E4%BD%BF%E7%94%A8/" target="_blank">k8s中yaml文件编写与使用</a><br></span><span>  6.<a class="is-size-6" href="/2020/08/04/k8s%E6%90%AD%E5%BB%BA/" target="_blank">kubernetes搭建</a><br></span><span>  7.<a class="is-size-6" href="/2020/08/04/%E5%88%9B%E5%BB%BAcentos%E9%95%9C%E5%83%8F%E6%94%AF%E6%8C%81ssh/" target="_blank">创建centos镜像支持ssh远程连接</a><br></span><span>  8.<a class="is-size-6" href="/2020/08/04/docker%E4%B8%80%E9%94%AE%E5%AE%89%E8%A3%85%E9%85%B7Q%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BAQQ%E6%9C%BA%E5%99%A8%E4%BA%BA/" target="_blank">docke一键安装酷Q搭建个人QQ机器人</a><br></span></div><div class="recommend-post"><span class="is-size-6 has-text-grey has-mr-7"># 推荐文章</span><br><span>  1.<a class="is-size-6" href="/2020/08/04/docker%E4%BD%BF%E7%94%A8/" target="_blank">docker的使用</a><br></span><span>  2.<a class="is-size-6" href="/2020/08/03/mysql%E5%9F%BA%E7%A1%80/" target="_blank">mysql基础</a><br></span><span>  3.<a class="is-size-6" href="/2020/08/03/nginx%E5%9F%BA%E7%A1%80/" target="_blank">nginx基础</a><br></span><span>  4.<a class="is-size-6" href="/2020/08/04/python3%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E9%87%8D%E7%82%B9/" target="_blank">python3基础知识重点</a><br></span><span>  5.<a class="is-size-6" href="/2023/05/07/Linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%B3%BB%E7%BB%9F%E7%9B%91%E6%8E%A7/" target="_blank">Prometheus监控linux</a><br></span><span>  6.<a class="is-size-6" href="/2023/05/10/Prometheus%E4%BD%BF%E7%94%A8%E9%82%AE%E7%AE%B1%E6%8E%A5%E6%94%B6%E5%91%8A%E8%AD%A6%E9%80%9A%E7%9F%A5/" target="_blank">Prometheus使用邮件接收告警通知</a><br></span></div></div><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/social-share.js/1.0.16/css/share.min.css"><div class="social-share"></div><script src="https://cdnjs.loli.net/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button is-info donate"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="https://yichenxiu.com/tupian/tubiao/alipay1.jpg" alt="支付宝"></span></a><a class="button is-success donate"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="https://i.328888.xyz/2023/03/05/dZXCk.jpeg" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2020/08/04/docker_%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">docker命令大全</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2020/08/04/openspug%E6%A3%80%E6%B5%8B/"><span class="level-item">docker部署openspug检测</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div id="comment-container"></div><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/gitalk/1.6.0/gitalk.css"><script> $.getScript('/js/gitalk.min.js', function () { 
            var gitalk = new Gitalk({
            language:'zh-CN',
            id: 'ffc51dddef33db9d81cc3e4c06110c69',
            repo: 'issue_database',
            owner: 'zhi666',
            clientID: '1b861f81e9a79ee6028d',
            clientSecret: 'cc629aff090aa9c60d5e13ddf7fcfce14f00a478',
            admin: ["zhi666"],
            createIssueManually: true,
            distractionFreeMode: true,
            perPage: 10,
            pagerDirection: 'last',
            proxy: 'https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token',
            
            enableHotKey: true,
            isLocked: false
        })
        gitalk.render('comment-container')});</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><div class="card widget toc-scroll" id="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list toc"><li><a class="is-flex toc-item" id="toc-item-一，docker介绍使用" href="#一，docker介绍使用"><span>一，docker介绍使用</span></a><ul class="menu-list toc"><li><a class="is-flex toc-item" id="toc-item-1-Docker-安装" href="#1-Docker-安装"><span>1.Docker 安装</span></a><ul class="menu-list toc"><li><a class="is-flex toc-item" id="toc-item-1-1docker疑难杂症：docker命令Tab无法自动补全" href="#1-1docker疑难杂症：docker命令Tab无法自动补全"><span>1.1docker疑难杂症：docker命令Tab无法自动补全</span></a></li><li><a class="is-flex toc-item" id="toc-item-2-使用脚本安装-Docker" href="#2-使用脚本安装-Docker"><span>2.使用脚本安装 Docker</span></a></li><li><a class="is-flex toc-item" id="toc-item-3-删除卸载Docker-CE" href="#3-删除卸载Docker-CE"><span>3,删除卸载Docker CE</span></a></li></ul></li><li><a class="is-flex toc-item" id="toc-item-2-Docker的使用" href="#2-Docker的使用"><span>2.Docker的使用</span></a><ul class="menu-list toc"><li><a class="is-flex toc-item" id="toc-item-4-运行容器" href="#4-运行容器"><span>4.运行容器</span></a></li><li><a class="is-flex toc-item" id="toc-item-2-1Dockerfile-详解" href="#2-1Dockerfile-详解"><span>2.1Dockerfile 详解</span></a></li><li><a class="is-flex toc-item" id="toc-item-3-搭建私有镜像仓库" href="#3-搭建私有镜像仓库"><span>3,搭建私有镜像仓库</span></a></li><li><a class="is-flex toc-item" id="toc-item-2-利用consul服务管理" href="#2-利用consul服务管理"><span>2.利用consul服务管理</span></a></li><li><a class="is-flex toc-item" id="toc-item-5-docker容器数据持久化本地挂载" href="#5-docker容器数据持久化本地挂载"><span>5.docker容器数据持久化本地挂载</span></a></li><li><a class="is-flex toc-item" id="toc-item-6，volume卷管理" href="#6，volume卷管理"><span>6，volume卷管理</span></a></li></ul></li><li><a class="is-flex toc-item" id="toc-item-3-docker-compose-多容器部署" href="#3-docker-compose-多容器部署"><span>3,docker-compose 多容器部署</span></a><ul class="menu-list toc"><li><a class="is-flex toc-item" id="toc-item-1-安装" href="#1-安装"><span>1.安装</span></a></li><li><a class="is-flex toc-item" id="toc-item-2-docker-compose用法" href="#2-docker-compose用法"><span>2.docker-compose用法</span></a></li><li><a class="is-flex toc-item" id="toc-item-3-YAML简介" href="#3-YAML简介"><span>3.YAML简介</span></a></li><li><a class="is-flex toc-item" id="toc-item-4-docker-compose中YAML常用的字段：" href="#4-docker-compose中YAML常用的字段："><span>4.docker-compose中YAML常用的字段：</span></a></li></ul></li></ul></li></ul></div></div><script type="text/javascript" async>
        $(document).ready(function () { //参考自 https://github.com/ppoffice/hexo-theme-icarus/pull/616/files
            var observerTopMargin;
            var scrollObserver;
            var headerElems = $(".headerlink");
            var activeTocItem;
        
            function initIntersectionObserver(docHeight) {
                observerTopMargin = docHeight;
                scrollObserver = new IntersectionObserver(scrollCallBack,
                    {
                        root: null,  // viewpoint
                        rootMargin: docHeight + "px 0px -80% 0px"  // cover top 30% of viewport to the top of document
                    })
            }
        
            function scrollCallBack(entries, observer) {
                if ($(window).scrollTop() > observerTopMargin * 0.7) { 
                    // User somehow scroll to 70% of observerTopMargin (which is inited as 200% document height)
                    // Observer top margin need to extend to cover all the space to the top of the document
                    initIntersectionObserver(observerTopMargin * 2)
                    observer.disconnect();
                    return;
                }
                let toActive;
                if (entries[0].intersectionRatio == 1) {  // enter viewed area
                    let entry = entries.reduce((u, v) => (u.target.toc_id > v.target.toc_id ? u : v));  // get the lowest item
                    toActive = $("#toc-item-" + $(entry.target).attr("href").substr(1));
                } else {
                    let entry = entries.reduce((u, v) => (u.target.toc_id < v.target.toc_id ? u : v));  // get the highest item
                    let idx = Math.max(entry.target.toc_id - 1, 0);
                    toActive = $("#toc-item-" + $(headerElems[idx]).attr("href").substr(1));
                }
                if (activeTocItem) activeTocItem.removeClass("is-current");
                activeTocItem = toActive
                activeTocItem.addClass("is-current");
            }
        
            initIntersectionObserver($(document).height() * 2);
            headerElems.each(function (index, obj) {
                obj.toc_id = index;
                scrollObserver.observe(obj);
            })
        });</script></div><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="is-rounded" src="/img/toudong.jpg" alt="逸尘秀"></figure><p class="title is-size-4 is-block line-height-inherit">逸尘秀</p><p class="is-size-6 is-block">只此一生 ， 必须快乐 ！</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>深圳</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">136</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">17</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">55</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://weibo.com/u/6155656382" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-white is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/zhi666"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-white is-marginless" target="_blank" rel="noopener" title="Weibo" href="https://weibo.com/u/6155656382"><i class="fab fa-weibo"></i></a><a class="level-item button is-transparent is-white is-marginless" target="_blank" rel="noopener" title="Email" href="mailto:1378373724@qq.com"><i class="fa fa-envelope"></i></a><a class="level-item button is-transparent is-white is-marginless" target="_blank" rel="noopener" title="Next" href="https://zhi666.github.io/remove.io"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-white is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div><div><hr><p id="hitokoto">:D 一言句子获取中...</p><script type="text/javascript" defer>function getYiyan(){
                                $.getJSON("https://v1.hitokoto.cn/", function (data) {
                                if(data){
                                    $('#hitokoto').html("");
                                    $('#hitokoto').append("<strong style='color: #3273dc;'>"+data.hitokoto+"</strong>"+
                                    "<p>"+"来源《"+data.from+"》</p><p>提供者-"+data.creator+"</p>");
                                }});}
                                $(function (){getYiyan();$('#hitokoto').click(function(){getYiyan();})});</script></div></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">最新评论</h3><span class="body_hot_comment">加载中，最新评论有1分钟缓存...</span></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2023-11-01T02:25:44.578Z">2023-11-01</time></p><p class="title is-6"><a class="link-muted" href="/2023/11/01/selenlium%E6%89%B9%E9%87%8F%E6%B7%BB%E5%8A%A0dns%E5%9F%9F%E5%90%8D/">批量添加dns域名解析</a></p><p class="is-uppercase"><i class="fas fa-folder-open has-text-grey"> </i><a class="link-muted" href="/categories/python/">python</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2023-05-17T01:45:36.000Z">2023-05-17</time></p><p class="title is-6"><a class="link-muted" href="/2023/05/17/Kubernetes%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%83%A8%E7%BD%B2/">Kubernetes高可用集群二进制部署</a></p><p class="is-uppercase"><i class="fas fa-folder-open has-text-grey"> </i><a class="link-muted" href="/categories/linux3/">linux3</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2023-05-10T06:25:36.000Z">2023-05-10</time></p><p class="title is-6"><a class="link-muted" href="/2023/05/10/Prometheus%E4%BD%BF%E7%94%A8%E6%89%8B%E6%9C%BA%E7%94%B5%E8%AF%9D_%E7%9F%AD%E4%BF%A1%E6%8E%A5%E6%94%B6%E5%91%8A%E8%AD%A6%E9%80%9A%E7%9F%A5/">Prometheus使用手机电话_短信接收告警通知</a></p><p class="is-uppercase"><i class="fas fa-folder-open has-text-grey"> </i><a class="link-muted" href="/categories/linux2/">linux2</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2023-05-10T06:22:36.000Z">2023-05-10</time></p><p class="title is-6"><a class="link-muted" href="/2023/05/10/Prometheus%E4%BD%BF%E7%94%A8%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%8E%A5%E6%94%B6%E5%91%8A%E8%AD%A6%E9%80%9A%E7%9F%A5/">Prometheus使用企业微信接收告警通知</a></p><p class="is-uppercase"><i class="fas fa-folder-open has-text-grey"> </i><a class="link-muted" href="/categories/linux2/">linux2</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2023-05-10T06:20:36.000Z">2023-05-10</time></p><p class="title is-6"><a class="link-muted" href="/2023/05/10/Prometheus%E4%BD%BF%E7%94%A8%E4%BC%81%E4%B8%9A%E9%92%89%E9%92%89%E5%91%8A%E8%AD%A6%E9%80%9A%E7%9F%A5/">Prometheus使用企业钉钉接收告警通知</a></p><p class="is-uppercase"><i class="fas fa-folder-open has-text-grey"> </i><a class="link-muted" href="/categories/linux2/">linux2</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/English/"><span class="level-start"><span class="level-item">English</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/HTML/"><span class="level-start"><span class="level-item">HTML</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/JS/"><span class="level-start"><span class="level-item">JS</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/html/"><span class="level-start"><span class="level-item">html</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/linux1/"><span class="level-start"><span class="level-item">linux1</span></span><span class="level-end"><span class="level-item tag">15</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/linux2/"><span class="level-start"><span class="level-item">linux2</span></span><span class="level-end"><span class="level-item tag">33</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/linux3/"><span class="level-start"><span class="level-item">linux3</span></span><span class="level-end"><span class="level-item tag">27</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/python/"><span class="level-start"><span class="level-item">python</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/web/"><span class="level-start"><span class="level-item">web</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/work/"><span class="level-start"><span class="level-item">work</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><a class="level is-mobile is-marginless" href="/categories/"><span class="level-start"><span class="level-item">查看全部&gt;&gt;</span></span></a></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2023/11/"><span class="level-start"><span class="level-item">十一月 2023</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2023/05/"><span class="level-start"><span class="level-item">五月 2023</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2023/04/"><span class="level-start"><span class="level-item">四月 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2023/02/"><span class="level-start"><span class="level-item">二月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2022/06/"><span class="level-start"><span class="level-item">六月 2022</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><a class="level is-mobile is-marginless" href="/archives/"><span class="level-start"><span class="level-item">查看全部&gt;&gt;</span></span></a></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/linux/"><span class="tag">linux</span><span class="tag is-grey-lightest">18</span></a></div><div class="control"><a class="tags has-addons" href="/tags/docker/"><span class="tag">docker</span><span class="tag is-grey-lightest">16</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Prometheus/"><span class="tag">Prometheus</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/html/"><span class="tag">html</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/python/"><span class="tag">python</span><span class="tag is-grey-lightest">12</span></a></div><div class="control"><a class="tags has-addons" href="/tags/web/"><span class="tag">web</span><span class="tag is-grey-lightest">12</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nginx/"><span class="tag">nginx</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mysql/"><span class="tag">mysql</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%AE%B9%E5%99%A8/"><span class="tag">容器</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"><span class="tag">数据库</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/"><span class="tag">科学上网</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/work/"><span class="tag">work</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96/"><span class="tag">自动化</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8D%9A%E5%AE%A2/"><span class="tag">博客</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%B7%A5%E4%BD%9C/"><span class="tag">工作</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%B7%A5%E5%85%B7/"><span class="tag">工具</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssl/"><span class="tag">ssl</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/"><span class="tag">文件系统</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%97%A5%E5%BF%97/"><span class="tag">日志</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%97%A5%E5%BF%97%E5%8A%A0%E5%AF%86/"><span class="tag">日志加密</span><span class="tag is-grey-lightest">3</span></a></div></div><div class="field is-grouped is-grouped-multiline"><a class="tags has-addons" href="/tags/"><span class="tag">查看全部&gt;&gt;</span></a></div></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=zhi666FeedsId&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="zhi666FeedsId" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="订阅"></div></div><p class="help">输入邮箱开始订阅，更博后邮件通知！</p></form></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.png" alt="逸尘秀" height="28"></a><p class="size-small"><span>&copy; 2023 yichen</span>  Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>,Modify by <a href="https://github.com/removeif/hexo-theme-amazing" target="_blank">removeif</a> <br><span>© 版权说明：[本网站所有内容均收集于互联网或自己创作,<br />&nbsp;&nbsp;&nbsp;&nbsp;方便于网友与自己学习交流，如有侵权，请<a href="/message" target="_blank">留言</a>，立即处理]<br /></span><span><span id="statistic-times">loading...</span><script>function createTime(time) {
            var n = new Date(time);
            now.setTime(now.getTime() + 250),
                days = (now - n) / 1e3 / 60 / 60 / 24,
                dnum = Math.floor(days),
                hours = (now - n) / 1e3 / 60 / 60 - 24 * dnum,
                hnum = Math.floor(hours),
            1 == String(hnum).length && (hnum = "0" + hnum),
                minutes = (now - n) / 1e3 / 60 - 1440 * dnum - 60 * hnum,
                mnum = Math.floor(minutes),
            1 == String(mnum).length && (mnum = "0" + mnum),
                seconds = (now - n) / 1e3 - 86400 * dnum - 3600 * hnum - 60 * mnum,
                snum = Math.round(seconds),
            1 == String(snum).length && (snum = "0" + snum),
                document.getElementById("statistic-times").innerHTML = "❤️本站自 <strong>"+time.split(" ")[0].replace(/\//g,".")+"</strong> 已运行 <strong>" + dnum + "</strong> 天 <strong>" + hnum + "</strong> 小时 <strong>" + mnum + "</strong> 分 <strong>" + snum + "</strong> 秒！❤️";
        }var now = new Date();setInterval("createTime('2020/08/02 00:00:00')", 250,"");</script><br></span><div class="size-small"><span>❤️感谢 <strong><span id="busuanzi_value_site_uv">99+</span></strong> 小伙伴的 <strong><span id="busuanzi_value_site_pv">99+</span></strong> 次光临！❤️</span></div></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/zhi666"><i class="fab fa-github"></i></a></p></div><div class="sideMusic"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="/js/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><meting-js style="width: auto;height: 2000px;" server="netease" type="playlist" id="2364053447" theme="#2980b9" loop="all" autoplay="false" order="list" storageName="aplayer-setting" lrctype="0" list-max-height="400px" fixed="true"></meting-js></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://yc6.cool',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back-to-top.js" defer></script><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.12/js/lightgallery-all.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js" defer></script><!--!--><!--!--><!--!--><script src="/js/toc.js" defer></script><script src="/js/main.js" defer></script><script>$.getScript('/js/comment-issue-data.js',function(){loadIssueData('1b861f81e9a79ee6028d','cc629aff090aa9c60d5e13ddf7fcfce14f00a478','zhi666','issue_database',false);})</script><link rel="stylesheet" href="/css/insight.css"><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input class="searchbox-input ins-search-input" type="text" placeholder="想要查找什么..."><span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>(function (window) {
            var INSIGHT_CONFIG = {
                TRANSLATION: {
                    POSTS: '文章',
                    PAGES: '页面',
                    CATEGORIES: '分类',
                    TAGS: '标签',
                    UNTITLED: '(无标题)',
                },
                CONTENT_URL: '/content.json',
            };
            window.INSIGHT_CONFIG = INSIGHT_CONFIG;
        })(window);</script><script src="/js/insight.js" defer></script></body></html>